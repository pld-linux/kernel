--- linux/fs/buffer.c.org	Thu May 24 10:54:46 2001
+++ linux/fs/buffer.c	Thu May 24 10:56:53 2001
@@ -2031,8 +2031,8 @@
 	mark_buffer_uptodate(bh, uptodate);
 
 	kiobuf = bh->b_private;
-	unlock_buffer(bh);
 	end_kio_request(kiobuf, uptodate);
+	unlock_buffer(bh);
 }
 
 
