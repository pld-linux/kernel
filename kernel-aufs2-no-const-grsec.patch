--- linux-3.0/fs/aufs/dynop.c	2011-08-24 12:17:44.788277908 +0200
+++ linux-3.0/fs/aufs/dynop.c	2011-08-24 12:11:22.375748361 +0200
@@ -149,9 +149,11 @@
 #define DySet(func, dst, src, h_op, h_sb) do {				\
 	DyDbgInc(cnt);							\
 	if (h_op->func) {						\
-		if (src.func)						\
-			dst.func = src.func;				\
-		else							\
+		if (src.func) {						\
+			pax_open_kernel();				\
+			*(void **)&dst.func = src.func;			\
+			pax_close_kernel();				\
+		} else							\
 			AuDbg("%s %s\n", au_sbtype(h_sb), #func);	\
 	}								\
 } while (0)
@@ -159,7 +161,9 @@
 #define DySetForce(func, dst, src) do {		\
 	AuDebugOn(!src.func);			\
 	DyDbgInc(cnt);				\
-	dst.func = src.func;			\
+	pax_open_kernel();			\
+	*(void **)&dst.func = src.func;		\
+	pax_close_kernel();			\
 } while (0)
 
 #define DySetAop(func) \
@@ -266,15 +270,17 @@
  */
 static void dy_adx(struct au_dyaop *dyaop, int do_dx)
 {
+	pax_open_kernel();
 	if (!do_dx) {
-		dyaop->da_op.direct_IO = NULL;
-		dyaop->da_op.get_xip_mem = NULL;
+		*(void **)&dyaop->da_op.direct_IO = NULL;
+		*(void **)&dyaop->da_op.get_xip_mem = NULL;
 	} else {
-		dyaop->da_op.direct_IO = aufs_aop.direct_IO;
-		dyaop->da_op.get_xip_mem = aufs_aop.get_xip_mem;
+		*(void **)&dyaop->da_op.direct_IO = aufs_aop.direct_IO;
+		*(void **)&dyaop->da_op.get_xip_mem = aufs_aop.get_xip_mem;
 		if (!dyaop->da_get_xip_mem)
-			dyaop->da_op.get_xip_mem = NULL;
+			*(void **)&dyaop->da_op.get_xip_mem = NULL;
 	}
+	pax_close_kernel();
 }
 
 static struct au_dyaop *dy_aget(struct au_branch *br,
