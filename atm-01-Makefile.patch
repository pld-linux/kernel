--- linux-2.4.20/net/atm/Makefile.orig	Sat Aug  3 02:39:46 2002
+++ linux-2.4.20/net/atm/Makefile	Wed Mar  5 23:15:50 2003
@@ -14,32 +14,18 @@
 list-multi	:= mpoa.o
 mpoa-objs	:= mpc.o mpoa_caches.o mpoa_proc.o
 
-obj-$(CONFIG_ATM) := addr.o pvc.o signaling.o svc.o common.o atm_misc.o raw.o resources.o
+obj-y	:= addr.o pvc.o signaling.o svc.o common.o atm_misc.o raw.o resources.o ipcommon.o
 
-ifeq ($(CONFIG_ATM_CLIP),y)
-obj-y += clip.o
-NEED_IPCOM = ipcommon.o
+ifeq ($(CONFIG_ATM),m)
+obj-m += $(O_TARGET)
 endif
 
-ifeq ($(CONFIG_ATM_BR2684),y)
-  NEED_IPCOM = ipcommon.o
-else
-  ifeq ($(CONFIG_ATM_BR2684),m)
-	NEED_IPCOM = ipcommon.o
-  endif
-endif
-obj-$(CONFIG_ATM_BR2684) += br2684.o
-
-ifeq ($(CONFIG_NET_SCH_ATM),y)
-NEED_IPCOM = ipcommon.o
-endif
-
-obj-y += $(NEED_IPCOM)
-
 ifeq ($(CONFIG_PROC_FS),y)
 obj-y += proc.o
 endif
 
+obj-$(CONFIG_ATM_CLIP) += clip.o
+obj-$(CONFIG_ATM_BR2684) += br2684.o
 obj-$(CONFIG_ATM_LANE) += lec.o
 obj-$(CONFIG_ATM_MPOA) += mpoa.o
 obj-$(CONFIG_PPPOATM) += pppoatm.o
