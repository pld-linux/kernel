--- linux-2.2.25-ow1/linux-2.2.25-ow1.diff~	Fri Feb 27 21:37:43 2004
+++ linux-2.2.25-ow1/linux-2.2.25-ow1.diff	Fri Feb 27 21:40:55 2004
@@ -578,15 +578,6 @@
  	current->tss.error_code = error_code;
  	current->tss.trap_no = 13;
  	force_sig(SIGSEGV, current);
-@@ -389,7 +571,7 @@
- 			goto clear_TF;
- 	}
- 
--	/* Mast out spurious debug traps due to lazy DR7 setting */
-+	/* Mask out spurious debug traps due to lazy DR7 setting */
- 	if (condition & (DR_TRAP0|DR_TRAP1|DR_TRAP2|DR_TRAP3)) {
- 		if (!tsk->tss.debugreg[7])
- 			goto clear_dr7;
 diff -urPX nopatch linux-2.2.25/arch/m68k/config.in linux/arch/m68k/config.in
 --- linux-2.2.25/arch/m68k/config.in	Sun Mar 25 20:31:50 2001
 +++ linux/arch/m68k/config.in	Thu Mar 20 14:07:47 2003
@@ -960,18 +951,6 @@
  	bprm.p = PAGE_SIZE*MAX_ARG_PAGES-sizeof(void *);
  	for (i=0 ; i<MAX_ARG_PAGES ; i++)	/* clear page-table */
  		bprm.page[i] = 0;
-diff -urPX nopatch linux-2.2.25/drivers/sgi/char/graphics.c linux/drivers/sgi/char/graphics.c
---- linux-2.2.25/drivers/sgi/char/graphics.c	Sun Mar 25 20:31:41 2001
-+++ linux/drivers/sgi/char/graphics.c	Thu Mar 20 14:07:47 2003
-@@ -105,7 +105,7 @@
- 
- 		if (board >= boards)
- 			return -EINVAL;
--		if (max_len < sizeof (struct gfx_getboardinfo_args))
-+		if (max_len < (int)sizeof (struct gfx_getboardinfo_args))
- 			return -EINVAL;
- 		if (max_len > cards [board].g_board_info_len)
- 			max_len = cards [boards].g_board_info_len;
 diff -urPX nopatch linux-2.2.25/fs/binfmt_aout.c linux/fs/binfmt_aout.c
 --- linux-2.2.25/fs/binfmt_aout.c	Fri Nov  2 19:39:08 2001
 +++ linux/fs/binfmt_aout.c	Thu Mar 20 14:07:47 2003
@@ -1380,30 +1359,6 @@
  
  	current->dumpable = was_dumpable;
  
-diff -urPX nopatch linux-2.2.25/fs/fat/inode.c linux/fs/fat/inode.c
---- linux-2.2.25/fs/fat/inode.c	Tue May 21 03:32:35 2002
-+++ linux/fs/fat/inode.c	Thu Mar 20 14:07:47 2003
-@@ -852,7 +852,8 @@
- 	i_pos = MSDOS_I(inode)->i_location;
- 	if (inode->i_ino == MSDOS_ROOT_INO || !i_pos) return;
- 	if (!(bh = fat_bread(sb, ((unsigned long long) i_pos) >> MSDOS_DPB_BITS))) {
--		printk("dev = %s, ino = %ld\n", kdevname(inode->i_dev), i_pos);
-+		printk("dev = %s, ino = %ld\n",
-+			kdevname(inode->i_dev), (long)i_pos);
- 		fat_fs_panic(sb, "msdos_write_inode: unable to read i-node block");
- 		return;
- 	}
-diff -urPX nopatch linux-2.2.25/fs/inode.c linux/fs/inode.c
---- linux-2.2.25/fs/inode.c	Sun Mar 25 20:37:38 2001
-+++ linux/fs/inode.c	Thu Mar 20 14:07:47 2003
-@@ -891,6 +891,7 @@
- 
- void update_atime (struct inode *inode)
- {
-+    if ( inode->i_atime == CURRENT_TIME ) return;
-     if ( IS_NOATIME (inode) ) return;
-     if ( IS_NODIRATIME (inode) && S_ISDIR (inode->i_mode) ) return;
-     if ( IS_RDONLY (inode) ) return;
 diff -urPX nopatch linux-2.2.25/fs/namei.c linux/fs/namei.c
 --- linux-2.2.25/fs/namei.c	Fri Nov  2 19:39:08 2001
 +++ linux/fs/namei.c	Thu Mar 20 14:07:47 2003
@@ -1568,11 +1523,20 @@
  	start = NULL;
  	dp = (struct proc_dir_entry *) inode->u.generic_ip;
  	
--	if (pid && process_unauthorized(type, pid))
-+	if (pid && process_unauthorized(type, pid, inode))
- 	{
+-	if (pid && process_unauthorized(type, pid)) {
++	if (pid && process_unauthorized(type, pid, inode)) {
  		free_page(page);
  		return -EIO;
+ 	}
+@@ -1555,7 +1567,7 @@
+ 		free_page(page);
+ 		return length;
+ 	}
+-	if (pid && process_unauthorized(type, pid)) {
++	if (pid && process_unauthorized(type, pid, inode)) {
+ 		free_page(page);
+ 		return -EIO;
+ 	}
 diff -urPX nopatch linux-2.2.25/fs/proc/base.c linux/fs/proc/base.c
 --- linux-2.2.25/fs/proc/base.c	Sun Mar 25 20:30:58 2001
 +++ linux/fs/proc/base.c	Thu Mar 20 14:07:47 2003
@@ -1678,41 +1642,6 @@
  	proc_scsi = create_proc_entry("scsi", S_IFDIR, 0);
  #ifdef CONFIG_SYSCTL
  	proc_register(&proc_root, &proc_sys_root);
-diff -urPX nopatch linux-2.2.25/fs/select.c linux/fs/select.c
---- linux-2.2.25/fs/select.c	Mon Sep 16 20:26:32 2002
-+++ linux/fs/select.c	Thu Mar 20 14:07:47 2003
-@@ -265,7 +265,7 @@
- 	fd_set_bits fds;
- 	char *bits;
- 	long timeout;
--	int ret, size;
-+	int ret, size, max_fdset;
- 
- 	timeout = MAX_SCHEDULE_TIMEOUT;
- 	if (tvp) {
-@@ -299,8 +299,11 @@
- 	 
- 	if (n < 0)
- 		goto out_nofds;
--	if (n > current->files->max_fdset)
--		n = current->files->max_fdset;
-+	max_fdset = current->files->max_fdset;
-+	if (n > max_fdset)
-+		n = max_fdset;
-+	if (n > NR_OPEN)
-+		n = NR_OPEN;
- 		
- 	/*
- 	 * We need 6 bitmaps (in/out/ex for both incoming and outgoing),
-@@ -412,7 +415,7 @@
- 	lock_kernel();
- 	/* Do a sanity check on nfds ... */
- 	err = -EINVAL;
--	if (nfds > current->files->max_fds || nfds > 0x100000)
-+	if (nfds > current->files->max_fds || nfds > NR_OPEN)
- 		goto out;
- 
- 	if (timeout) {
 diff -urPX nopatch linux-2.2.25/include/asm-i386/a.out.h linux/include/asm-i386/a.out.h
 --- linux-2.2.25/include/asm-i386/a.out.h	Sun Mar 25 20:31:05 2001
 +++ linux/include/asm-i386/a.out.h	Thu Mar 20 14:07:47 2003
@@ -2028,29 +1957,6 @@
  	addr = PAGE_ALIGN(addr);
  
  	for (vmm = find_vma(current->mm, addr); ; vmm = vmm->vm_next) {
-diff -urPX nopatch linux-2.2.25/mm/swapfile.c linux/mm/swapfile.c
---- linux-2.2.25/mm/swapfile.c	Fri Nov  2 19:39:16 2001
-+++ linux/mm/swapfile.c	Thu Mar 20 14:07:47 2003
-@@ -367,14 +367,11 @@
- 	for (type = swap_list.head; type >= 0; type = swap_info[type].next) {
- 		p = swap_info + type;
- 		if ((p->flags & SWP_WRITEOK) == SWP_WRITEOK) {
--			if (p->swap_file) {
--				if (p->swap_file == dentry)
--				  break;
--			} else {
--				if (S_ISBLK(dentry->d_inode->i_mode)
--				    && (p->swap_device == dentry->d_inode->i_rdev))
--				  break;
--			}
-+			if (p->swap_file == dentry)
-+				break;
-+			if (S_ISBLK(dentry->d_inode->i_mode) &&
-+			    p->swap_device == dentry->d_inode->i_rdev)
-+				break;
- 		}
- 		prev = type;
- 	}
 diff -urPX nopatch linux-2.2.25/security/Common.in linux/security/Common.in
 --- linux-2.2.25/security/Common.in	Thu Jan  1 03:00:00 1970
 +++ linux/security/Common.in	Thu Mar 20 14:07:47 2003
