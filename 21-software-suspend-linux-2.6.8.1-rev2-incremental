diff -ruN software-suspend-linux-2.6.8.1-mm2-rev1/arch/i386/kernel/apm.c software-suspend-linux-2.6.8.1-mm2-rev2/arch/i386/kernel/apm.c
--- software-suspend-linux-2.6.8.1-mm2-rev1/arch/i386/kernel/apm.c	2004-08-19 22:50:30.000000000 +1000
+++ software-suspend-linux-2.6.8.1-mm2-rev2/arch/i386/kernel/apm.c	2004-08-20 20:52:46.817973680 +1000
@@ -223,7 +223,7 @@
 #include <linux/smp.h>
 #include <linux/smp_lock.h>
 #include <linux/dmi.h>
-#include <linux/suspend.h>
+#include <linux/suspend1.h>
 
 #include <asm/system.h>
 #include <asm/uaccess.h>
diff -ruN software-suspend-linux-2.6.8.1-mm2-rev1/drivers/md/kcopyd.c software-suspend-linux-2.6.8.1-mm2-rev2/drivers/md/kcopyd.c
--- software-suspend-linux-2.6.8.1-mm2-rev1/drivers/md/kcopyd.c	2004-08-17 18:32:20.000000000 +1000
+++ software-suspend-linux-2.6.8.1-mm2-rev2/drivers/md/kcopyd.c	2004-08-20 20:52:46.855967904 +1000
@@ -609,7 +609,7 @@
 		return r;
 	}
 
-	_kcopyd_wq = create_singlethread_workqueue("kcopyd");
+	_kcopyd_wq = create_singlethread_workqueue("kcopyd", 0);
 	if (!_kcopyd_wq) {
 		jobs_exit();
 		up(&kcopyd_init_lock);
diff -ruN software-suspend-linux-2.6.8.1-mm2-rev1/kernel/power/suspend_version_specific.c software-suspend-linux-2.6.8.1-mm2-rev2/kernel/power/suspend_version_specific.c
--- software-suspend-linux-2.6.8.1-mm2-rev1/kernel/power/suspend_version_specific.c	2004-08-20 20:52:45.060240896 +1000
+++ software-suspend-linux-2.6.8.1-mm2-rev2/kernel/power/suspend_version_specific.c	2004-08-20 20:52:46.924957416 +1000
@@ -136,6 +136,7 @@
 			display_device_tree(suspend_device_tree,
 				"suspend_drivers_suspend stage 3.\n");
 			device_suspend_tree(3, suspend_device_tree);
+			device_shutdown();
 			display_device_tree(suspend_device_tree,
 				"Post power down device tree.\n");
 
